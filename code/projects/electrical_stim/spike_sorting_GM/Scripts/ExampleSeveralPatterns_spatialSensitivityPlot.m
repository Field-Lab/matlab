pathnames = {'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p129.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p130.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p132.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p133.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p134.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p135.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p136.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p138.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p140.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p141.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p142.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p143.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p144.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p148.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p149.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p150.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p151.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p152.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p156.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p157.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p158.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p159.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p160.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p164.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p165.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p166.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p167.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p168.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p172.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p173.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p174.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p175.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p176.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p180.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p181.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p182.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p183.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p184.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p188.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p189.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p190.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p191.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p192.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p196.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p197.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p198.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p199.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p200.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p204.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p205.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p206.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p207.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p208.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p212.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p213.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p214.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p215.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p216.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p220.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p221.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p222.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p223.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p224.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p228.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p229.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p230.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p231.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p232.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p237.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p238.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p239.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n3457_p246.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n3457_p258.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n3457_p259.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p105.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p106.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p107.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p108.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p109.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p110.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p111.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p112.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p113.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p114.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p115.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p116.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p117.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p118.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p119.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p120.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p258.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p259.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p263.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p264.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p266.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p267.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p268.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p271.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p272.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p274.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p275.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p276.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p279.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p280.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4058_p283.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p295.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p296.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p298.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p299.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p302.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p303.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p304.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p306.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p307.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p308.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p310.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p311.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p312.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p314.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p315.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p316.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p318.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p319.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p64.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p68.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p69.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p70.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p71.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p72.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p73.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p74.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p75.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p76.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p77.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p78.mat';
'/Volumes/Analysis/2012-09-24-3/data004/elecResp_n4656_p79.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n4656_p322.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n4656_p323.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n4656_p326.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n4656_p327.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n4656_p64.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p130.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p137.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p138.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p146.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p147.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p154.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p163.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p170.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p171.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p179.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p180.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p186.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p187.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p188.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p195.mat';
'/Volumes/Analysis/2012-09-24-3/data003/elecResp_n2796_p196.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p338.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p34.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p342.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p343.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p344.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p345.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p346.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p347.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p348.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p349.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p35.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p350.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p351.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p357.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p358.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p36.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p361.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p37.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p38.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p39.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p40.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p41.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5123_p42.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p1.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p12.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p16.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p2.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p3.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p371.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p376.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p379.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p380.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p384.mat';
'/Volumes/Analysis/2012-09-24-3/data005/elecResp_n5748_p7.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n5748_p425.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n5748_p433.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n5748_p441.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n5748_p442.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n5748_p449.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n5748_p457.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n5748_p465.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n5748_p473.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p429.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p430.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p431.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p436.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p437.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p438.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p446.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p454.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p462.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p469.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p478.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p485.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p493.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p494.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p500.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p508.mat';
'/Volumes/Analysis/2012-09-24-3/data006/elecResp_n6439_p509.mat'}; 
%%
for p = 1:length(pathnames)
    
    
    clear input
    clear initial
    clear Gibbs
    clear GibbsNoDelete
    clear Log
    p
%     pathToAnalysisData = pathnames;
    temp = load(pathnames{p});
    patternNo = temp.elecResp.stimInfo.patternNo;
    pathToAnalysisData = temp.elecResp.names.data_path;
    neuronIds = temp.elecResp.cells.main;
    
    
    % analyze. *An elecResp file with each
    % neuron number must exist*
    % any recElecs, then the script gets the recording
    % electrodes from the elecResp file. If you
    % list electrodes here, the script does not
    % use the electrodes from elecResp. Instead,
    % a function (prefElectrodes) is used to
    % assign a main recording electrode to each
    % of the neuronIds (chosen from this list of
    % recElecs). The main recording electrode
    % for each neuron is the electrode with the
    % largest signal from the visual stim
    % template. Other electrodes are used in the
    % heuristics to improve the sigmoidal fit.
    % Listing more recElecs is going to increase
    % the algorithm runtime.
    
     %Default minimum and maximum recording times. If the first part of the
     %traces are not relevant, it could be worth trying make Tmin>1
     Tmin     = 1;
     Tmax     = 40;
     input.tracesInfo.Trange        =    [Tmin Tmax];                                                                                       
         
    
    % Load Templates from ElecResp. If recElecs are not supplied, then will be
    % found from the 'goodElecs' field.
    [templates, recElecs] = makeTemplatesFromElecResp(pathToAnalysisData,...
        patternNo,neuronIds,1); %This function will output one electrode per neuron
    if(size(templates{1},2)==81) %Usually, when templates have length 81, they are aligned
        %To spike onset at time ~20. The following
        %line re-aligns them to onset at time 10
        [templates, recElecs] = makeTemplatesFromElecResp(pathToAnalysisData,...
            patternNo,neuronIds,11);
    end
    
    %translate templates if by some reason there are weird template offsets.   
    %templates = translateTemplate(templates,Translate(p),1,1); % The minimum of each
    % template should always align with sample point 10
    
    %for each neuron, find the 'preFerred' electrode
    prefElectrodes = PreferredElectrodes(templates); % Looks for the template with the maximum signal for each neuron
    input.neuronInfo.prefElectrodes =   prefElectrodes; %Define preferred electrodes
    input.tracesInfo.recElecs      =    recElecs; %define recording electrodes
    input.neuronInfo.neuronIds     =    neuronIds; %define neuron Ids
    input.neuronInfo.templates     =    templates; %define templates
    
    %Parameters to find a Axonal activation authomatically.
    %if includeAxonBreakpoint=0 no axonal breakpoint will be included
    input.params.load.findAxon.includeAxonBreakpoint  =   0; % For now, set to zero because the axonal breakpoint solution is not working
    input.params.load.findAxon.numberOmit             =   4;
    input.params.load.findAxon.lMovingAverage         =   1;
    input.params.load.findAxon.TrangeAxon             =  [11 40];
    %If one, look for decreases in the minimum of the eigenvalues of the
    %variance (space) of the energy plot. If equal 2 looks for increases
    input.params.load.findAxon.typeEigenvalue         =   2;
    % cleanData = 1 erases the first trial of each movie (for cases where some
    % of the trials did not result in electrical stimulation as intended)
    input.params.load.cleanData                       =   1;
    % if collapseTrialsSameCondition = 1 Collapse movies 2*j and 2*j-1
    input.params.load.collapseTrialsSameCondition     =   1;
    
    
    %loads data from movie files
    input = loadData(input,pathToAnalysisData,patternNo);
    
    %Fill default values for input
    input = fillDefaultValues(input);
    
    %any change in the default values should be done at this point;
    %input.params.initial.degPolRule{e}=[1 2 3 50]; example of a redefinition of a default value

    
    
    %finds initial values for the artifact and rest of variables (via convex
    %relaxation with cvx-Mosek)
    initial = Initialize(input);
    
    
    %The Core of the algorithm: spike sorting via gibbs sampler + heuristics.
    %solutions are stored in Gibbs Structure
    [Gibbs GibbsNoDelete initial input Log] = doSpikeSortingElectricalArtifact(input,initial);
    
    Output(p) = OutputResults(input,Gibbs,Log);
    
    
end
    

